

#  도커 이미지(Image)


- 도커는 이미지를 만들기 위해 **컨테이너의 상태를 그대로 이미지로 저장**하는 단순한 방법을 사용한다.

![image](https://user-images.githubusercontent.com/15938354/120000421-bfce2c80-c00d-11eb-96b8-c3e7613086fd.png)


- 예를 들어, 어떤 애플리케이션을 이미지로 만든다면 리눅스만 설치된 컨테이너에 애플리케이션을 설치하고
그 상태를 그대로 이미지로 저장한다.(가상머신의 스냅샷과 비슷한 방식)

- 이미지는 **컨테이너 실행에 필요한 파일과 설정값 등을 포함**하고 있음. 

- 변하지 않는다.(Immutable)

- **컨테이너는 이미지를 실행한 상태.**

- 추가되거나 변하는 값은 컨테이너에 저장됨.

- 같은 이미지에서 여러 개의 컨테이너를 생성할 수 있고 컨테이너의 상태가 바뀌거나 컨테이너가 삭제되더라도 
이미지는 변하지 않고 그대로 남아 있다.

![image](https://user-images.githubusercontent.com/15938354/119999074-51d53580-c00c-11eb-8e9c-1886bfbe3c37.png)


- 도커 이미지는 컨테이너를 실행하기 위한 모든 정보를 가지고 있어서 보통 용량이 수백 MB에 이른다.

- 파일 하나 추가 시 수백 MB를 다 받기는 부담이 크다.

- 도커는 이런 문제를 해결하기 위해 **레이어(Layer)라는 개념을 사용**한다.

- 유니온 파일 시스템을 사용하여 여러 개의 레이어를 하나의 파일시스템으로 사용.

![image](https://user-images.githubusercontent.com/15938354/120002900-3409cf80-c010-11eb-99e1-9cace8eecf89.png)


- 이미지를 풀 받을 때 뭔가를 나눠서 받고 있다. 
- 이 한 줄 한 줄이 레이어에 해당한다. 
- 이미지를 풀 받으면 레이어들은 독립적으로 저장된다. 
- 그리고 컨테이너를 실행할 때는 이 레이어들을 차례대로 쌓아올려서 특정 위치에 마운트를 합니다. 
- 기본적으로 이미지에 속하는 레이어들은 읽기 전용이기 때문에 절대로 변하지 않는다.
- 그리고 그 위에 마지막으로 컨테이너 전용 쓰기 가능한 레이어를 한 층 더 쌓고, 컨테이너에서 일어나는 모든 변경 사항을 이 레이어에 저장한다.

- nginx:latest 이미지는 위에서 확인할 수 있듯이 총 3개의 레이어로 나뉘어져 있다. 
- 순서대로 제일 아래의 레이어가 000eee12ec04가 됩니다. 그 위에 차례대로 eb22865337de, bee5d581ef8b 레이어를 쌓아올리면 nginx:latest 이미지가 된다.


### 참고 자료:
- https://www.44bits.io/ko/post/how-docker-image-work
- https://cultivo-hy.github.io/docker/image/usage/2019/03/14/Docker%EC%A0%95%EB%A6%AC/
- https://subicura.com/2017/02/10/docker-guide-for-beginners-create-image-and-deploy.html
