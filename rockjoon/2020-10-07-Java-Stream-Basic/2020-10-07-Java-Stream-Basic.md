# 자바 스트림 개념

## 1. 스트림 소개

### (1) 스트림이란 ?

스트림이란 컬렉션(또는 배열)의 요소를 람다식으로 처리하는 반복자

---

## 2. 스트림 특징
스트림의 특징은 `람다식`, `내부반복자`, `중간처리와 최종처리` 3가지가 있다.  

### (1). 람다식  
스트림에서 제공하는 메소드는 대부분 **함수적 인터페이스를 매개변수**로 가지기 때문에 람다식으로 표현할 수 있다.   

### (2). 내부반복자  
* 외부반복자 : 일반적인 반복문인 for와 while문에 해당.    
* 외부반복자는 개발자가 `직접 요소들을 반복`하고, `요소당 처리해야할 코드`를 제어
* 내부반복자 : `컬렉션 내부에서 요소들이 반복되`고, 요소당 `처리해야할 코드만` 전달
* 내부반복자는 **내부적으로 반복 순서를 변경**하거나, **병렬 처리**를 할 수 있기 때문에 더 효율적

### (3). 중간처리와 최종처리
* 중간처리란 매핑, 필터링, 정렬 등의 작업을 뜻한다.
* 최종 처리는 반복, 카운팅, 평균, 합계 등의 집계처리를 뜻한다.
* 스트림은 이처럼 중간처리와 최종처리가 나뉘어져 있다. (그 이유는 파이프라인 항목에서)

---

## 3 스트림 소스의 종류
스트림을 사용할 수 있는 스트림 소스의 종류는 다음이 있다.
* 컬렉션 
```java
new ArrayList().stream()
```
* 배열
```java
Arrays.stream(arr)
```
* 숫자 범위
```java
IntStream.rangeClosed(1, 100)   //1 부터 100까지의 정수 범위의 스트림
```
* 파일
```java
Files.lines(path, Charset.defaultCharset());    // 해당 path의 파일의 라인을 스트림에 저장
```
* 디렉토리
```java
Files.list(path);   // path의 파일 또는 디렉토리 하위의 정보를 가져옴.
```
---

## 4. 파이프라인
### (1) 파이프라인이란?
파이프라인이란 `여러 개의 스트림이 연결되어 있는 구조`를 뜻한다.

### (2) 중간 처리와 최종 처리
* 우리가 스트림을 사용하는 이유는 대량의 **데이터를 집계**하여 원하는 결과물을 얻기 위해서 이다.
* 그러나 데이터를 집계하기 위해서는 중간처리가 필요한 경우가 있다.
* 따라서 여러개의 스트림을 연결하여 `가장 마지막 스트림은 최종 처리`(집계 처리) 스트림, `그 외의 다른 스트림을 중간 스트림`으로 구분하며 이러한 구조를 파이프라인이라 한다.
* 중간 스트림과 최종 스트림을 구분하는 가장 쉬운 방법은 리턴 타입이 Stream일 경우 중간스트림이고, 리턴타입이 객체 또는 기본값일 경우 최종 스트림이다.

### (3) lazy evaluation
* 파이프라인에서는 lazy evaluation 방식이 사용된다.
* lazy 방식이란 해당 값이 실행될 때 이를 처리하지 않고 최종적으로 그 값이 필요할 때 실행하는 것을 뜻한다.
* 말로 하면 그 뜻이 바로 이해가 되지 않는다. 아래 예제를 보자.
```java
if( fn1() || fn2() ){
    start();
}
```
* 예제에서 `fn1` '또는' `fn2`의 리턴값이 `true`일 경우 `start()`가 실행된다.
* 만약 lazy방식이 아니라면 어떤식으로 진행될까? (lazy evaluation의 반대를 eager evaluation이라 한다.)
* 자바 입장에서는 fn1과 fn2가 **모두 실행**되고 나서야 둘 중 하나가 참이면 start()를 실행한다는 것을 알게 될 것이다.
* 그러나 java에서 or 연산은 lazy하게 작동하도록 되어 있다.
* 이 말은 즉 fn1과 fn2가 실행되야 할 시점에 이를 실행하지 않고 기다렸다가 || 연산까지 확인 한다.
* ||를 확인하고 나면 `둘 중 하나만 true여도 된다`는 것을 알기 때문에 그제서야 fn1을 실행하고
fn1()이 true일 경우 fn2는 실행하지 않고 start()메소드로 넘어가는 것이다.