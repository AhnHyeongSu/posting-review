# gRPC란?

## 1. 배경지식
### 1.1 RPC(Remote Procedure Call)
#### 1.1.1 RPC란?
- RPC(Remote Procedure Call)
    - 원격 프로시져 호출
    - 원격에 위치한 프로그램을 로컬에 있는 프로그램처럼 사용할 수 있다.
    - 분산 네트워크 컴퓨터환경에서 프로그래밍을 쉽게 하기 위해 나온 방식
- 예시
    ```
    # Client
    z = function(x, y)
    ```
    ```
    # Server
    function(x, y) {
    compute x, y
    return z
    }
    ```
#### 1.1.2 RPC 동작방식
![rpc](https://mindock.github.io/assets/images/RPC_concept.png)
- Caller / Callee
    - 사용자(Client, Server)가 필요한 비즈니스 로직을 실행하는 Layer
    - IDL(Interface definition Language)로 작성
- Stub
    - Stub Compiler가 IDL 파일을 읽어 원하는 Lagnuage로 생성
    - Parameter Object를 Message로 marsharlling/unmarshalling하는 Layer
- RPC runtime
    - Server와 Client를 Building하는 Layer
    - 커뮤니케이션 중 발생한 에러처리도 진행


### 1.2 IDL(Interface Definition Language)
- IDL(Interface Definition Language): 인터페이스 정의 언어
    - 정보를 저장하는 규칙
- proto 
    - gRPC에서 사용하는 데이터 형식, gRPC는 proto3을 사용하는 것이 좋음
    ```
    message Person {
        string name = 1;
        int32 id = 2;
        bool has_ponycopter = 3;
    }
    ```
- 예) XML, JSON, Proto 등
![3개 데이터 구조 비교](https://miro.medium.com/max/1400/1*PTZ_ELRZlbCZKqOBbCJ2Jg.png)

## 2. gRPC
### 2.1 gRPC란?
- Google에서 개발한 `RPC(Remote Procedure Call)` 시스템
- TCP/IP 프로토콜과 HTTP 2.0 프로토콜 사용
- `IDL(Interface Definition Language)`로 protocol buffer를 사용

### 2.2 gRPC의 구조
![gRPC](https://grpc.io/img/landing-2.svg)
- 클라이언트 어플리케이션은 마치 로컬 객체인 것처럼 다른 머신에 있는 서버 어플리케이션의 메서드를 직접 호출할 수 있음
- 따라서 분산 어플리케이션 및 서비스를 더 쉽게 만들 수 있다.
- 다양한 환경에서 실행 가능 (Go, Python, Ruby, Java 등)

### 2.3 gRPC 예제 (java)
- [gRPC 예제](https://grpc.io/docs/languages/)
    - C#, C+, Dart, Go, Java, Kotline, Node, Object-C, PHP, Python, Ruby 지원

`Java 예제` - Server, Client를 다른 언어로 바꿔도 됨.
`src/main/proto/helloworld.proto`
```proto
// The greeting service definition.
service Greeter {
  // Sends a greeting
  rpc SayHello (HelloRequest) returns (HelloReply) {}
}

// The request message containing the user's name.
message HelloRequest {
  string name = 1;
}

// The response message containing the greetings
message HelloReply {
  string message = 1;
}
```
`src/main/java/helloworld/HelloWorldServer.java`
```java
  /**
   * Main launches the server from the command line.
   */
  public static void main(String[] args) throws IOException, InterruptedException {
    final HelloWorldServer server = new HelloWorldServer();
    server.start();
    server.blockUntilShutdown();
  }

  static class GreeterImpl extends GreeterGrpc.GreeterImplBase {

    @Override
    public void sayHello(HelloRequest req, StreamObserver<HelloReply> responseObserver) {
      HelloReply reply = HelloReply.newBuilder().setMessage("Hello " + req.getName()).build();
      responseObserver.onNext(reply);
      responseObserver.onCompleted();
    }
  }
```
`src/main/java/helloworld/HelloWorldClient.java`
```java
  /** Say hello to server. */
  public void greet(String name) {
    logger.info("Will try to greet " + name + " ...");
    HelloRequest request = HelloRequest.newBuilder().setName(name).build();
    HelloReply response;
    try {
      response = blockingStub.sayHello(request);
    } catch (StatusRuntimeException e) {
      logger.log(Level.WARNING, "RPC failed: {0}", e.getStatus());
      return;
    }
    logger.info("Greeting: " + response.getMessage());
  }
```
`실행`
![grpc-1](https://user-images.githubusercontent.com/37948906/111739222-07299580-88c6-11eb-88c9-f5cbbb682355.PNG)
![grpc-2](https://user-images.githubusercontent.com/37948906/111739152-e9f4c700-88c5-11eb-887c-9cb531a677b8.PNG)
![grpc-3](https://user-images.githubusercontent.com/37948906/111739159-ebbe8a80-88c5-11eb-84c7-eb23ac9f0242.PNG)


## 참고자료
- [grpc quickstart 공식 문서](https://grpc.io/docs/languages/java/quickstart/)
- [what is grpc 공식 문서](https://grpc.io/docs/what-is-grpc/introduction/)
- [RPC란](https://nesoy.github.io/articles/2019-07/RPC)
- [gRPC](https://chacha95.github.io/2020-06-15-gRPC1/)
