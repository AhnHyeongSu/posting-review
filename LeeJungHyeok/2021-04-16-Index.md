#인덱스, 다중인덱스, 탐색 시나리오

## 인덱스
Wiki에서 설명 하는 인덱스를 다음과 같다.
```
인덱스(영어: index)는 데이터베이스 분야에 있어서 테이블에 대한 동작의 속도를 높여주는 자료 구조를 일컫는다. 인덱스는 테이블 내의 1개의 컬럼, 혹은 여러 개의 컬럼을 이용하여 생성될 수 있다. 
고속의 검색 동작뿐만 아니라 레코드 접근과 관련 효율적인 순서 매김 동작에 대한 기초를 제공한다.
인덱스를 저장하는 데 필요한 디스크 공간은 보통 테이블을 저장하는 데 필요한 디스크 공간보다 작다. 
(왜냐하면 보통 인덱스는 키-필드만 갖고 있고, 테이블의 다른 세부 항목들은 갖고 있지 않기 때문이다.) 
관계형 데이터베이스에서는 인덱스는 테이블 부분에 대한 하나의 사본이다.
```
이리저리 말이 많이 적혀 있지만 정리해보면 테이블에 어떤 동작을 요청할 때 동작에 대한 속도를 높여주는 자료 구조 말하는구나 라고 생각한다.

인덱스는 조회 할때 사용하는 것이 보편적이다.  
이외에 INSERT, UPDATE, DELETE의 경우 성능이 떨어지는데 이유는 각 행위마다 아래의 연산을 추가적으로 해줘야 하기 때문에 그에 따른 오버헤드가 발생하기 때문이다.  
```
INSERT: 새로운 데이터에 대한 인덱스를 추가함
DELETE: 삭제하는 데이터의 인덱스를 사용하지 않는다는 작업을 진행함
UPDATE: 기존의 인덱스를 사용하지 않음 처리하고, 갱신된 데이터에 대해 인덱스를 추가함
```

위키에서 속도를 높여주는 자료구조 라고 했는데 내부 구현에 따라 다양한 자료구조를 구현하지만 가장 보편적인 자료구조는 B-Tree 이다.
또 인덱스는 Cardinality(카디널리티(기수성))을 보고 적용해야한다. 

기수성은 예제를 통해 설명하면
```
상황 ( 대한민국 모든 사람들에 대한 테이블)

성별을 저장하고 있는 컬럼은 기수성이 낮다. ex( 남여 )
주민번호를 저장하고 있는 컬럼은 기수성이 높다 ex( 주민번호 ) 
```
라고 설명 할 수 있다.
인덱스는 기수성이 높을 수록 큰 효율이 높아진다.  

그리고 인덱스는 다음곽 같은 쿼리문으로 설정한다.
```
CREATE INDEX index_name ON table_name (column_name);
```

## 다중인덱스와 탐색 시나리오
다중인덱스는 말 그대로 하나의 인덱스에 여러 컬럼을 설정하는 것을 말한다.
```
CREATE INDEX index_name ON table_name (column_name1, column_name2, column_name3);
```
위 쿼리문에서 컬럼이름에 대해서 좀 더 설명하자면 
```
CREATE INDEX index_name ON table_name (column_name2, column_name1, column_name3);
```
```
CREATE INDEX index_name ON table_name (column_name1, column_name2, column_name3);
```
바로위 두 쿼리문은 컬럼이름의 순서가 바뀌어 있다.  
이 두 인덱스로 column_name1, column_name2, column_name3 순으로 조회 할 때 두 쿼리문은 서로 다른 성능을 가진다.

그렇기 때문에 순서에 유의 하여 작성해야 한다.
차이가 나는 이유는 컬럼 이름의 순서에 따라 정렬이 되기 때문인데,  

column_name2를 먼저 작성한 쿼리문의 경우 column_name1을 먼저 조회하는 쿼리문이 들어오면 column_name1에 대한 정렬이 안됬기 때문에 
모든 column_name1을 탐색하게 된다.  

그러면 이 순서를 어떻게 정할까? 에 대해 배운것을 통해 정리 하자면 다음과 같다. 

- 테이블의 탐색 시나리오와 기수성을 파악하여 설정한다. 

탐색 시나리오는 말 그대로 테이블안에 있는 데이터를 탐색 할 때 주로 어떤 목적으로 탐색 할것인지에 대한 시나리오이다.  
예를 들어 대한민국 모든 사람의 데이터가 들어있는 테이블이 있고, 군대를 갈 수 있는 사람을 조회 할 목적이라면  
군대를 갈 수 있는 사람을 조회 하는 것이 하나의 시나리오 라고 볼 수 있다.

컬럼은, 나이, 주민번호, 성별, 몸무게, 주소지 가 있고 할때.

군대를 갈 수 있는 사람을 조회 하기 위해서 나이, 성별, 몸무게를 알아야 할것이다. 

위에서도 설명한걸 보면 기수성이 높은 순서대로 설정하는 것이 좋다고 했는데, 

일단 주민번호를 통해 나이를 알수 있고 기수성이 높기 때문에 맨 앞에 적으면 되고, 성별과 몸무게의 경우 몸무게가 기수성이 상대적으로 높기 때문에
그 다음으로 작성하고 마지막으로 성별은 기수성이 매우 낮기 때문에 설정하는것에 대해선 본인의 판단을 통해 설정 유무를 결정하면될 거같다. 

그리고 이렇게 정리된 것을 쿼리문으로 작성하면
```
CREATE INDEX index_name ON all_korean_table (주민번호, 몸무게, 성별);
```
이렇게 작성 할 수 있다.


#출처
[인덱스 - 망나니개발자](https://mangkyu.tistory.com/96#:~:text=%ED%95%B4%EC%8B%9C%20%ED%85%8C%EC%9D%B4%EB%B8%94%20%EA%B8%B0%EB%B0%98%EC%9D%98%20DB,%EB%B9%A0%EB%A5%B8%20%EA%B2%80%EC%83%89%EC%9D%84%20%EC%A7%80%EC%9B%90%ED%95%9C%EB%8B%A4.)
[인덱스 - 군고구마 주형권](https://burning-dba.tistory.com/79)
[인덱스 - 위키](https://ko.wikipedia.org/wiki/%EC%9D%B8%EB%8D%B1%EC%8A%A4_(%EB%8D%B0%EC%9D%B4%ED%84%B0%EB%B2%A0%EC%9D%B4%EC%8A%A4))